<html>
<head>
<script language="javascript">
    var port = parseInt(location.port) + 1;
    var ws = new WebSocket('ws://' + location.hostname + ':' + port);
    ws.onmessage = function(msg) {
        // convert base64 to string
        var data = atob(msg.data);
        // decoding utf-8 chars
        data = decodeURIComponent(escape(data));
        // show data
        var text = document.getElementById('out');
        text.value += data;
        text.scrollTop = text.scrollHeight;
    }
    ws.onclose = function() { console.log('Connection closed.'); }

    function send(str) {
        ws.send(btoa(str));
    }
    function keypress(e) {
        //console.log('keypress', e.keyCode, e.charCode);
        e.preventDefault();
        var code = e.charCode || e.keyCode;
        send(String.fromCharCode(code));
    }
    function keydown(e) {
        //console.log('keydown', e.keyCode, e.charCode);
        switch(e.keyCode) {
            case 8: // Backspace
                e.preventDefault();
                send(String.fromCharCode(8));
                break;
            case 9: // Tab
                e.preventDefault();
                send(String.fromCharCode(9));
                break;
            case 13: // Enter
                e.preventDefault();
                send(String.fromCharCode(10));
                break;
            case 33: // PageUp
            case 34: // PageDown
            case 35: // End
            case 36: // Home
            case 37: // Left
            case 38: // Up
            case 39: // Right
            case 40: // Down
                e.preventDefault();
        }
    }
</script>
</head>
<body>
    <textarea id="out" cols="120" rows="40" onkeypress="keypress(event);" onkeydown="keydown(event);"></textarea>
</body>
</html>
